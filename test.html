<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IdealCar - System Test</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            padding: 40px;
        }
        
        h1 {
            color: #1a237e;
            margin-bottom: 10px;
        }
        
        .subtitle {
            color: #666;
            margin-bottom: 30px;
        }
        
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
        }
        
        .test-section h2 {
            color: #1a237e;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .test-item {
            padding: 15px;
            margin: 10px 0;
            background: #f8f9fa;
            border-radius: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .test-item.success {
            background: #d4edda;
            border-left: 4px solid #28a745;
        }
        
        .test-item.error {
            background: #f8d7da;
            border-left: 4px solid #dc3545;
        }
        
        .test-item.pending {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
        }
        
        .status {
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 12px;
        }
        
        .status.pass {
            background: #28a745;
            color: white;
        }
        
        .status.fail {
            background: #dc3545;
            color: white;
        }
        
        .status.testing {
            background: #ffc107;
            color: #333;
        }
        
        button {
            background: #1a237e;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s;
            margin: 10px 5px;
        }
        
        button:hover {
            background: #283593;
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(26, 35, 126, 0.3);
        }
        
        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .summary {
            background: linear-gradient(135deg, #1a237e, #283593);
            color: white;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 30px;
            text-align: center;
        }
        
        .summary h2 {
            margin-bottom: 20px;
        }
        
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .summary-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
        }
        
        .summary-value {
            font-size: 36px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .summary-label {
            font-size: 14px;
            opacity: 0.8;
        }
        
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #1a237e;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .log {
            background: #2c3e50;
            color: #2ecc71;
            padding: 20px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            max-height: 400px;
            overflow-y: auto;
            margin-top: 20px;
        }
        
        .log-line {
            margin: 5px 0;
        }
        
        .log-error {
            color: #e74c3c;
        }
        
        .log-success {
            color: #2ecc71;
        }
        
        .log-info {
            color: #3498db;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöó IdealCar System Test</h1>
        <p class="subtitle">Automated testing for backend API and frontend connectivity</p>
        
        <div class="summary" id="summary">
            <h2>Test Summary</h2>
            <div class="summary-grid">
                <div class="summary-item">
                    <div class="summary-value" id="totalTests">0</div>
                    <div class="summary-label">Total Tests</div>
                </div>
                <div class="summary-item">
                    <div class="summary-value" id="passedTests">0</div>
                    <div class="summary-label">Passed</div>
                </div>
                <div class="summary-item">
                    <div class="summary-value" id="failedTests">0</div>
                    <div class="summary-label">Failed</div>
                </div>
                <div class="summary-item">
                    <div class="summary-value" id="testTime">0s</div>
                    <div class="summary-label">Time</div>
                </div>
            </div>
        </div>
        
        <div style="text-align: center; margin-bottom: 30px;">
            <button onclick="runAllTests()">‚ñ∂Ô∏è Run All Tests</button>
            <button onclick="clearResults()">üóëÔ∏è Clear Results</button>
        </div>
        
        <div class="test-section">
            <h2>
                <i class="fas fa-server"></i>
                Backend API Tests
            </h2>
            <div id="backendTests"></div>
        </div>
        
        <div class="test-section">
            <h2>
                <i class="fas fa-car"></i>
                Car Management Tests
            </h2>
            <div id="carTests"></div>
        </div>
        
        <div class="test-section">
            <h2>
                <i class="fas fa-blog"></i>
                Blog Management Tests
            </h2>
            <div id="blogTests"></div>
        </div>
        
        <div class="test-section">
            <h2>
                <i class="fas fa-terminal"></i>
                Test Log
            </h2>
            <div class="log" id="testLog"></div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>
    <script>
        // Configurable API URL
        const API_BASE = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1'
            ? 'http://localhost:3000'
            : window.location.origin;
        const API_URL = `${API_BASE}/api`;
        let testResults = {
            total: 0,
            passed: 0,
            failed: 0
        };
        let startTime;
        
        function log(message, type = 'info') {
            const logDiv = document.getElementById('testLog');
            const timestamp = new Date().toLocaleTimeString();
            const className = `log-${type}`;
            logDiv.innerHTML += `<div class="log-line ${className}">[${timestamp}] ${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        function updateSummary() {
            document.getElementById('totalTests').textContent = testResults.total;
            document.getElementById('passedTests').textContent = testResults.passed;
            document.getElementById('failedTests').textContent = testResults.failed;
            
            if (startTime) {
                const elapsed = ((Date.now() - startTime) / 1000).toFixed(2);
                document.getElementById('testTime').textContent = elapsed + 's';
            }
        }
        
        function createTestItem(name, status = 'pending') {
            const statusClass = status === 'pass' ? 'success' : status === 'fail' ? 'error' : 'pending';
            const statusText = status === 'pass' ? 'PASS' : status === 'fail' ? 'FAIL' : 'TESTING';
            
            return `
                <div class="test-item ${statusClass}" id="test-${name.replace(/\s/g, '-')}">
                    <span>${name}</span>
                    <span class="status ${status}">${statusText}</span>
                </div>
            `;
        }
        
        function updateTestStatus(name, status, message = '') {
            const testId = `test-${name.replace(/\s/g, '-')}`;
            const testElement = document.getElementById(testId);
            
            if (testElement) {
                const statusClass = status === 'pass' ? 'success' : 'error';
                const statusText = status === 'pass' ? 'PASS' : 'FAIL';
                
                testElement.className = `test-item ${statusClass}`;
                testElement.querySelector('.status').className = `status ${status}`;
                testElement.querySelector('.status').textContent = statusText;
                
                testResults.total++;
                if (status === 'pass') {
                    testResults.passed++;
                    log(`‚úì ${name} - ${message}`, 'success');
                } else {
                    testResults.failed++;
                    log(`‚úó ${name} - ${message}`, 'error');
                }
                updateSummary();
            }
        }
        
        async function testBackendConnection() {
            try {
                const response = await fetch(`${API_URL.replace('/api', '')}/`);
                const data = await response.json();
                return { success: true, data };
            } catch (error) {
                return { success: false, error: error.message };
            }
        }
        
        async function testGetCars() {
            try {
                const response = await fetch(`${API_URL}/cars`);
                const data = await response.json();
                return { success: response.ok, data };
            } catch (error) {
                return { success: false, error: error.message };
            }
        }
        
        async function testGetBlogPosts() {
            try {
                const response = await fetch(`${API_URL}/blog`);
                const data = await response.json();
                return { success: response.ok, data };
            } catch (error) {
                return { success: false, error: error.message };
            }
        }
        
        async function testAdminLogin() {
            try {
                const response = await fetch(`${API_URL}/admin/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ password: 'admin123' })
                });
                const data = await response.json();
                return { success: response.ok && data.success, data };
            } catch (error) {
                return { success: false, error: error.message };
            }
        }
        
        async function testContactForm() {
            try {
                const response = await fetch(`${API_URL}/contact`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        name: 'Test User',
                        email: 'test@test.com',
                        phone: '0123456789',
                        message: 'Test message'
                    })
                });
                const data = await response.json();
                return { success: response.ok && data.success, data };
            } catch (error) {
                return { success: false, error: error.message };
            }
        }
        
        async function runAllTests() {
            startTime = Date.now();
            testResults = { total: 0, passed: 0, failed: 0 };
            
            log('Starting test suite...', 'info');
            log('='.repeat(50), 'info');
            
            // Setup test items
            document.getElementById('backendTests').innerHTML = 
                createTestItem('Backend Connection') +
                createTestItem('Admin Login') +
                createTestItem('Contact Form');
            
            document.getElementById('carTests').innerHTML = 
                createTestItem('Get All Cars') +
                createTestItem('Car Data Structure');
            
            document.getElementById('blogTests').innerHTML = 
                createTestItem('Get All Blog Posts') +
                createTestItem('Blog Data Structure');
            
            // Run tests
            log('Testing backend connection...', 'info');
            const backendTest = await testBackendConnection();
            updateTestStatus('Backend Connection', 
                backendTest.success ? 'pass' : 'fail',
                backendTest.success ? 'API is online' : backendTest.error
            );
            
            if (!backendTest.success) {
                log('Backend is not running! Start the backend server first.', 'error');
                return;
            }
            
            log('Testing admin login...', 'info');
            const loginTest = await testAdminLogin();
            updateTestStatus('Admin Login',
                loginTest.success ? 'pass' : 'fail',
                loginTest.success ? 'Login successful' : 'Login failed'
            );
            
            log('Testing contact form...', 'info');
            const contactTest = await testContactForm();
            updateTestStatus('Contact Form',
                contactTest.success ? 'pass' : 'fail',
                contactTest.success ? 'Form submission works' : 'Form failed'
            );
            
            log('Testing car API...', 'info');
            const carsTest = await testGetCars();
            updateTestStatus('Get All Cars',
                carsTest.success ? 'pass' : 'fail',
                carsTest.success ? `Found ${carsTest.data.length} cars` : carsTest.error
            );
            
            if (carsTest.success && carsTest.data.length > 0) {
                const hasRequiredFields = carsTest.data[0].make && carsTest.data[0].model && carsTest.data[0].price;
                updateTestStatus('Car Data Structure',
                    hasRequiredFields ? 'pass' : 'fail',
                    hasRequiredFields ? 'All required fields present' : 'Missing required fields'
                );
            } else {
                updateTestStatus('Car Data Structure', 'fail', 'No cars to validate');
            }
            
            log('Testing blog API...', 'info');
            const blogTest = await testGetBlogPosts();
            updateTestStatus('Get All Blog Posts',
                blogTest.success ? 'pass' : 'fail',
                blogTest.success ? `Found ${blogTest.data.length} posts` : blogTest.error
            );
            
            if (blogTest.success && blogTest.data.length > 0) {
                const hasRequiredFields = blogTest.data[0].title && blogTest.data[0].excerpt;
                updateTestStatus('Blog Data Structure',
                    hasRequiredFields ? 'pass' : 'fail',
                    hasRequiredFields ? 'All required fields present' : 'Missing required fields'
                );
            } else {
                updateTestStatus('Blog Data Structure', 'fail', 'No posts to validate');
            }
            
            log('='.repeat(50), 'info');
            log(`Test suite completed: ${testResults.passed}/${testResults.total} passed`, 
                testResults.failed === 0 ? 'success' : 'error');
        }
        
        function clearResults() {
            document.getElementById('backendTests').innerHTML = '';
            document.getElementById('carTests').innerHTML = '';
            document.getElementById('blogTests').innerHTML = '';
            document.getElementById('testLog').innerHTML = '';
            testResults = { total: 0, passed: 0, failed: 0 };
            startTime = null;
            updateSummary();
            log('Results cleared', 'info');
        }
        
        // Initial setup
        updateSummary();
        log('Test suite ready. Click "Run All Tests" to begin.', 'info');
    </script>
</body>
</html>
